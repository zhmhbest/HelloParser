
>[参考资料](https://deerchao.cn/tutorials/regex/regex.htm)

```js
// 【Javascript】

String.prototype.testMatch = function (reg) {
    //# /reg/  : 匹配一次后停止
    //# /reg/g : 全局匹配（重复匹配到结尾）
    //# /reg/i : 大小写不敏感
    //# /reg/m : 多行匹配
    console.log(this.replace(reg, s => {
        let buf = [];
        for(let i=0; i<s.length; i++) buf.push('■');
        return buf.join('');
    }));
};
```

### 特殊符号

| 符号 | 含义 |
| :--: | :--- |
| `^` | 匹配**字符串开头**的位置 |
| `$` | 匹配**字符串结尾**的位置 |

| 符号 | 等效表达 | 含义 |
| :--: | :------- | :--- |
| `.`  | `[\s\S]`          | 匹配任意一个字符 |
| `\b` |                   | 匹配单词的**开头**或**结尾**的位置 |
| `\B` |                   | 匹配一个不是（单词的**开头**或**结尾**）的位置 |
| `\s` | `[ \f\n\r\t\v]`   | 匹配一个**空白** |
| `\S` | `[^ \f\n\r\t\v]`  | 匹配一个**不是空白**的字符 |
| `\d` | `[0-9]`           | 匹配一个**数字** |
| `\D` | `[^0-9]`          | 匹配一个**不是数字**的字符 |
| `\w` | `[0-9a-zA-Z_]`    | 匹配一个**字母**或**数字**或**下划线** |
| `\W` | `[^0-9a-zA-Z_]`   | 匹配一个**不是字母**、**不是数字**、**不是下划线**的字符 |
|      | `[\u4e00-\u9fa5]` | 匹配一个**汉字** |
|      | `[^\x00-\xff]`    | 匹配一个**汉字**或**全角符号** |

| 符号 | 含义 |
| :--- | :--- |
| `\\`、`\|`、`\.` | 匹配一个`\`或`|`或`.` |
| `\?`、`\+`、`\*` | 匹配一个`?`或`+`或`*` |
| `\^`、`\$` | 匹配一个`^`或`$` |
| `\(`、`\)` | 匹配一个`(`或`)` |
| `\[`、`\]` | 匹配一个`[`或`]` |
| `\{`、`\}` | 匹配一个`{`或`}` |

```js
// 【Javascript】

  'I love learning'.testMatch(/./g);
// ■■■■■■■■■■■■■■■

  'I love learning'.testMatch(/^\w/g);
// ■ love learning

  'I love learning'.testMatch(/\w$/g);
// I love learnin■

  'I love learning'.testMatch(/\b\w+\b/g);
// ■ ■■■■ ■■■■■■■■

  'I love learning'.testMatch(/\s/g);
// I■love■learning

  'I love learning'.testMatch(/\S/g);
// ■ ■■■■ ■■■■■■■■
```

### 重复匹配

| 符号 | 贪婪 | 含义 |
| :--: | :--: | ---- |
| `?`  | √ | 重复`0`或`1`次（尽可能多） |
| `*`  | √ | 重复`0`或`∞`次（尽可能多）|
| `+`  | √ | 重复`1`或`∞`次（尽可能多） |

| 符号 | 贪婪 | 含义 |
| :--: | :--: | ---- |
| `??` | × | 重复`0`或`1`次（尽可能少） |
| `*?` | × | 重复`0`或`∞`次（尽可能少）|
| `+?` | × | 重复`1`或`∞`次（尽可能少）|

| 符号 | 贪婪 | 含义 |
| :--: | :--: | ---- |
| `{n}`    | - | 重复`n`次 |
| `{n,}`   | √ | 重复`n`或`∞`次（尽可能多）|
| `{n,m}`  | √ | 重复`n`到`m`次（尽可能多） |
| `{n,}?`  | × | 重复`n`或`∞`次（尽可能少）|
| `{n,m}?` | × | 重复`n`到`m`次（尽可能少） |

```js
// 【Javascript】

  '___###___###___'.testMatch(/#{3}/g);
// ___■■■___■■■___

  '___###___###___'.testMatch(/#{2,}/g);
// ___■■■___■■■___

  '___###___###___'.testMatch(/#{2,}?/g);
// ___■■#___■■#___

  '___###___###___'.testMatch(/#{2}/g);
// ___■■#___■■#___
```

### 多条件匹配

| 表达式 | 含义 |
| -: | :- |
| `[abc]`      | 匹配一个字符`a`或`b`或`c` |
| `[a-c]`      | 匹配一个字符`a`或`b`或`c` |
| `[a-c0-2]`   | 匹配一个字符`a`或`b`或`c`或`0`或`1`或`2` |
| `[^abc]`     | 匹配一个不是（字符`a`或`b`或`c`）的字符 |
| `[^a-c]`     | 匹配一个不是（字符`a`或`b`或`c`）的字符 |
| `[^a-c0-2]`  | 匹配一个不是（字符`a`或`b`或`c`或`0`或`1`或`2`）的字符 |
| <code>#{3}&vert;@{3}</code> | 匹配`###`或`@@@` |

```js
// 【Javascript】

  '___012___ABC___abc___'.testMatch(/[abc]/g);
// ___012___ABC___■■■___

  '___012___ABC___abc___'.testMatch(/[^abc]/g);
// ■■■■■■■■■■■■■■■abc■■■

  '___012___ABC___abc___'.testMatch(/[0-2]/g);
// ___■■■___ABC___abc___

  '___012___ABC___abc___'.testMatch(/[a-c0-2]/g);
// ___■■■___ABC___■■■___

  '___###___@@@___'.testMatch(/#{3}|@{3}/g);
// ___■■■___■■■___

  '___###___@@@___'.testMatch(/#{2,}|@{2,}/g);
// ___■■■___■■■___
```

### 分组匹配

| 表达式 | 含义 |
| :----- | :--- |
| `(?#comment)`                         | 注释 |
| `(exp)`                               | 捕获成组，分配序号 |
| `(?:exp)`                             | 捕获成组，后面无法再引用 |
| `(?<gname>exp)`                       | 捕获成组，定义组名`gname` |
| `(?<-gname>)`                         | 移除组`gname`，后面无法再引用 |
| <code>(?(gname)expY&vert;expN)</code> | 存在组`gname`则匹配`expY`，否则匹配`expN` |
| `\number`                             | 后向引用，重复匹配**已确定**的组内容 |
| `\k<gname>`                           | 后向引用，重复匹配**已确定**的组内容 |

```js
// 【Javascript】

  '192.168.1.100'.testMatch(/\d{1,3}\./);
// ■■■■168.1.100

  '192.168.1.100'.testMatch(/(\d{1,3}\.){3}/);
// ■■■■■■■■■■100

  'I am who I am'.testMatch(/(I) (am) who \1 \2/);
// ■■■■■■■■■■■■■

  'I am who I am'.testMatch(/(?<name>I am) who \k<name>/);
// ■■■■■■■■■■■■■
```

### 零宽断言

>- 两个**正断言**是先把内容匹配出来，再看匹配的内容开头或结尾是否满足断言
>- 两个**负断言**是在匹配完成后，再看未匹配的位置前后是否满足断言
>- **断言内容都不被包含在匹配的内容里面**

| 名称 | 表达式 | 含义 |
| :-: | :- | :- |
| 零宽度正回顾后发断言 | `(?<=exp)body` | 开头包含`exp`   |
| 零宽度正预测先行断言 | `body(?=exp)`  | 结尾包含`exp`   |
| 零宽度负回顾后发断言 | `(?<!exp)body` | 开头不包含`exp` |
| 零宽度负预测先行断言 | `body(?!exp)`  | 结尾不包含`exp` |

```js
// 【Javascript】

// a开头
  'I am singing while you are dancing'.testMatch(/(?<=\ba)\w+\b/g);
// I a■ singing while you a■■ dancing

// ing结尾
  'I am singing while you are dancing'.testMatch(/\b\w+(?=ing\b)/g);
// I am ■■■■ing while you are ■■■■ing

// 不以$开头
  '$count++; echo $count'.testMatch(/(?<!\$)\b\w+\b/g);
// $count++; ■■■■ $count

// 不以++结尾
  '$count++; echo $count'.testMatch(/\b\w+\b(?!\+\+)/g);
// $count++; ■■■■ $■■■■■
```

### 应用实例

**匹配手机**：

```js
// 【Javascript】
const regPhone = reg.make([/^/,
    {g: ['+86'], n: '?'},
    '1',
    /[0-9]{10}/,
/$/]);
// /^(\+86)?1[0-9]{10}$/

  '+8612388889999'.testMatch(regPhone);
// ■■■■■■■■■■■■■■
  '12388889999'.testMatch(regPhone);
// ■■■■■■■■■■■
```

**匹配邮箱**：

```js
// 【Javascript】
const regWords = /[0-9a-zA-Z]+/
const regMail = reg.make([/^/,
    regWords,
    '@',
    {g: [regWords, '.'], n: '+'},
    regWords,
/$/]);
// /^[0-9a-zA-Z]+@([0-9a-zA-Z]+\.)+[0-9a-zA-Z]+$/

  '123@abc.com'.testMatch(regMail);
// ■■■■■■■■■■■
  '123@163.com'.testMatch(regMail);
// ■■■■■■■■■■■
```

**匹配IP**：

```js
// 【Javascript】
// [200, 255] /2[0-5]{2}/
// [100, 199] /1[0-9]{2}/
// [010, 099] /[1-9][0-9]/
// [000, 009] /[0-9]/

const regIPNumCases = [/2[0-5]{2}/, /1[0-9]{2}/, /[1-9][0-9]/, /[0-9]/]
const regIP = reg.make([/^/, {g: [regIPNumCases, '.'], n: [3]}, regIPNumCases, /$/]);
// /^((2[0-5]{2}|1[0-9]{2}|[1-9][0-9]|[0-9])\.){3}(2[0-5]{2}|1[0-9]{2}|[1-9][0-9]|[0-9])$/

  '127.0.0.1'.testMatch(regIP);
// ■■■■■■■■■
  '02.0.0.0'.testMatch(regIP);
// 02.0.0.0
  '266.0.0.0'.testMatch(regIP);
// 266.0.0.0
  '255.0.0.0'.testMatch(regIP);
// ■■■■■■■■■
```

**匹配日期**：

```js
// 【Javascript】
// [0000, 2999]
const regYear = /[0-2]?[0-9]{1,3}/
// [10, 12] [01, 09]
const regMonthCases = [/1[0-2]/, /0?[1-9]/]
// 01-31 = [30, 31] [10, 29] [01, 09]
const regDayCases = [/3[0-1]/, /[1-2][0-9]/, /0?[1-9]/]

// yyyyMMdd
const regDateId = reg.make([/^/, regYear, regMonthCases, regDayCases, /$/]);
// /^[0-2]?[0-9]{1,3}(1[0-2]|0?[1-9])(3[0-1]|[1-2][0-9]|0?[1-9])$/

// yyyy-MM-dd
const regDate = reg.make([/^/, regYear, '-', regMonthCases, '-', regDayCases, /$/]);
// /^[0-2]?[0-9]{1,3}-(1[0-2]|0?[1-9])-(3[0-1]|[1-2][0-9]|0?[1-9])$/

  '29990101'.testMatch(regDateId);
// ■■■■■■■■

  '2999-01-01'.testMatch(regDate);
// ■■■■■■■■■■

  '2999-1-1'.testMatch(regDate);
// ■■■■■■■■
```
